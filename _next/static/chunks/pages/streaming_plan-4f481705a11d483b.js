(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{64248:function(t,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/streaming_plan",function(){return n(81245)}])},81245:function(t,r,n){"use strict";n.r(r),n.d(r,{default:function(){return M}});var e=n(47568),a=n(34051),o=n.n(a),i=n(85893),l=n(66479),c=n(40639),u=n(83234),s=n(20979),d=n(57026),f=n(47741),h=n(79855),v=n(97098),p=n(96486),x=n(9008),g=n.n(x),m=n(11163),y=n(67294),w=n(53812);function j(t){var r=t.mvDependency,n=t.svgWidth,e=t.selectedId,a=t.onSelectedIdChange,o=(0,y.useRef)(),l=(0,y.useState)("0px"),c=l[0],u=l[1],s=(0,y.useCallback)((function(){var t=(0,v.zx)().nodeSize([10,34,5]),n=(0,p.cloneDeep)(r),e=t(n);return{width:e.width,height:e.height,dag:n}}),[r]),d=s();return(0,y.useEffect)((function(){d.width;var t=d.height,r=d.dag,i=o.current,l=h.Ys(i),c=h.ak_,s=h.jvg().curve(c).x((function(t){return t.x+10})).y((function(t){return t.y})),f=function(t){return t.data.id===e},v=l.select(".edges").selectAll(".edge").data(r.links()),p=function(t){return t.attr("d",(function(t){var r=t.points;return s(r)})).attr("fill","none").attr("stroke-width",(function(t){return f(t.source)||f(t.target)?2:1})).attr("stroke",(function(t){return f(t.source)||f(t.target)?w.rS.colors.teal[500]:w.rS.colors.gray[300]}))};v.exit().remove(),v.enter().call((function(t){return t.append("path").attr("class","edge").call(p)})),v.call(p);var x=l.select(".nodes").selectAll(".node").data(r.descendants()),g=function(t){return t.attr("transform",(function(t){var r=t.x,n=t.y;return"translate(".concat(r+10,", ").concat(n,")")})).attr("fill",(function(t){return f(t)?w.rS.colors.teal[500]:w.rS.colors.gray[500]}))};x.exit().remove(),x.enter().call((function(t){return t.append("circle").attr("class","node").attr("r",5).call(g)})),x.call(g);var m=l.select(".labels").selectAll(".label").data(r.descendants()),y=function(t){return t.text((function(t){return t.data.name})).attr("x",n-10).attr("font-family","inherit").attr("text-anchor","end").attr("alignment-baseline","middle").attr("y",(function(t){return t.y})).attr("fill",(function(t){return f(t)?w.rS.colors.black[500]:w.rS.colors.gray[500]})).attr("font-weight","600")};m.exit().remove(),m.enter().call((function(t){return t.append("text").attr("class","label").call(y)})),m.call(y);var j=l.select(".overlays").selectAll(".overlay").data(r.descendants()),I=function(t){return t.attr("x",3).attr("height",24).attr("width",n-6).attr("y",(function(t){return t.y-5-12+2+3})).attr("rx",5).attr("fill",w.rS.colors.gray[500]).attr("opacity",0).style("cursor","pointer")};j.exit().remove(),j.enter().call((function(t){return t.append("rect").attr("class","overlay").call(I).on("mouseover",(function(t,r){h.Ys(this).transition().duration(parseInt(w.rS.transition.duration.normal)).attr("opacity",".10")})).on("mouseout",(function(t,r){h.Ys(this).transition().duration(parseInt(w.rS.transition.duration.normal)).attr("opacity","0")})).on("mousedown",(function(t,r){h.Ys(this).transition().duration(parseInt(w.rS.transition.duration.normal)).attr("opacity",".20")})).on("mouseup",(function(t,r){h.Ys(this).transition().duration(parseInt(w.rS.transition.duration.normal)).attr("opacity",".10")})).on("click",(function(t,r){a&&a(r.data.id)}))})),j.call(I),u("".concat(t,"px"))}),[r,e,n,a,d]),(0,i.jsxs)("svg",{ref:o,width:"".concat(n,"px"),height:c,children:[(0,i.jsx)("g",{className:"edges"}),(0,i.jsx)("g",{className:"nodes"}),(0,i.jsx)("g",{className:"labels"}),(0,i.jsx)("g",{className:"overlays"})]})}var I=n(41799),b=n(99534),k=n(828),S=n(39653),C=n(50471),D=n(63679),_=n(14293),N=(0,D.ZP)((function(){return n.e(171).then(n.t.bind(n,55171,23))}));function A(t,r){var n=r.dx,e=r.dy,a=h.G_s().nodeSize([e,n])(t);return a.each((function(t){var r;return r=[t.y,t.x],t.x=r[0],t.y=r[1],r})),a.each((function(t){return t.x=-t.x})),a}function z(t,r){var n=r.margin,e=n.top,a=n.bottom,o=n.left,i=n.right,l=1/0,c=-l,u=1/0,s=-u;return t.each((function(t){return c=t.x>c?t.x:c})),t.each((function(t){return l=t.x<l?t.x:l})),t.each((function(t){return s=t.y>s?t.y:s})),t.each((function(t){return u=t.y<u?t.y:u})),l-=o,c+=i,u-=e,s+=a,t.each((function(t){return t.x=t.x-l})),t.each((function(t){return t.y=t.y-u})),{width:c-l,height:s-u}}var E=12,F=E,q=E;function R(t){var r=t.planNodeDependencies,n=t.fragmentDependency,e=t.selectedFragmentId,a=(0,y.useRef)(),o=(0,S.qY)(),l=o.isOpen,c=o.onOpen,u=o.onClose,s=(0,y.useState)(),d=s[0],v=s[1],x=(0,y.useCallback)((function(){return function(t){v(t.data),c()}}),[c])(),g=(0,y.useCallback)((function(){var t=(0,p.cloneDeep)(r),e=(0,p.cloneDeep)(n),a=new Map,o=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var s,d=(0,k.Z)(c.value,2),f=d[0],h=d[1],v=A(h,{dx:72,dy:48}),x=z(v,{margin:{left:60,right:60,top:48,bottom:60}}),g=x.width,m=x.height;a.set(f,{layoutRoot:v,width:g,height:m,extraInfo:null!==(s=h.data.extraInfo)&&void 0!==s?s:""})}}catch(P){i=!0,l=P}finally{try{o||null==u.return||u.return()}finally{if(i)throw l}}var y=(0,_.bK)(e.map((function(t){t.width,t.height;var r=t.id,n=(0,b.Z)(t,["width","height","id"]),e=a.get(r),o=e.width,i=e.height;return(0,I.Z)({width:o,height:i,id:r},n)})),60,60),w=new Map;y.forEach((function(t){var r=t.id,n=t.x,e=t.y;w.set(r,{x:n,y:e})}));var j=[],S=!0,C=!1,D=void 0;try{for(var N,E=a[Symbol.iterator]();!(S=(N=E.next()).done);S=!0){var F=(0,k.Z)(N.value,2),q=F[0],R=F[1],Y=w.get(q),Z=Y.x,G=Y.y;j.push((0,I.Z)({id:q,x:Z,y:G},R))}}catch(P){C=!0,D=P}finally{try{S||null==E.return||E.return()}finally{if(C)throw D}}var L=0,M=0;j.forEach((function(t){var r=t.x,n=t.y,e=t.width,a=t.height;M=Math.max(M,n+a+50),L=Math.max(L,r+e)}));var O=(0,_.o)(y);return{layoutResult:j,fragmentLayout:y,svgWidth:L,svgHeight:M,links:O}}),[r,n]),m=g(),j=m.svgWidth,D=m.svgHeight,R=m.links,Y=(m.fragmentLayout,m.layoutResult);return(0,y.useEffect)((function(){if(Y){var t=a.current,r=h.Ys(t),n=h.h5h().x((function(t){return t.x})).y((function(t){return t.y})),o=function(t){return t===e},i=function(t){t.attr("transform",(function(t){var r=t.x,n=t.y;return"translate(".concat(r,", ").concat(n,")")}));var r=t.select(".actor-text-frag-id");r.empty()&&(r=t.append("text").attr("class","actor-text-frag-id")),r.attr("fill","black").text((function(t){var r=t.id;return"Fragment #".concat(r)})).attr("font-family","inherit").attr("text-anchor","end").attr("dy",(function(t){return t.height-q+12})).attr("dx",(function(t){return t.width-F})).attr("fill","black").attr("font-size",12);var e=t.select(".actor-text-actor-id");e.empty()&&(e=t.append("text").attr("class","actor-text-actor-id")),e.attr("fill","black").text((function(t){return t.extraInfo})).attr("font-family","inherit").attr("text-anchor","end").attr("dy",(function(t){return t.height-q+24})).attr("dx",(function(t){return t.width-F})).attr("fill","black").attr("font-size",12);var a=t.select(".bounding-box");a.empty()&&(a=t.append("rect").attr("class","bounding-box")),a.attr("width",(function(t){return t.width-24})).attr("height",(function(t){return t.height-24})).attr("x",F).attr("y",q).attr("fill","white").attr("stroke-width",(function(t){var r=t.id;return o(r)?3:1})).attr("rx",5).attr("stroke",(function(t){var r=t.id;return o(r)?w.rS.colors.teal[500]:w.rS.colors.gray[500]}));var i=t.select(".links");i.empty()&&(i=t.append("g").attr("class","links"));var l=function(t){return t.attr("d",n)},c=i.selectAll("path").data((function(t){return t.layoutRoot.links()}));c.enter().call((function(t){return t.append("path").attr("fill","none").attr("stroke",w.rS.colors.gray[700]).attr("stroke-width",1.5).call(l),t})),c.call(l),c.exit().remove();var u=t.select(".nodes");u.empty()&&(u=t.append("g").attr("class","nodes"));var s=function(t){t.attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}));var r=t.select("circle");r.empty()&&(r=t.append("circle")),r.attr("fill",w.rS.colors.teal[500]).attr("r",E).style("cursor","pointer").on("click",(function(t,r){return x(r)}));var n=t.select("text");return n.empty()&&(n=t.append("text")),n.attr("fill","black").text((function(t){return t.data.name})).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",21.6).attr("fill","black").attr("font-size",12).attr("transform","rotate(-8)"),t},d=u.selectAll(".actor-node").data((function(t){return t.layoutRoot.descendants()}));d.exit().remove(),d.enter().call((function(t){return t.append("g").attr("class","actor-node").call(s)})),d.call(s)},l=r.select(".actors").selectAll(".actor").data(Y);l.enter().call((function(t){return t.append("g").attr("class","actor").call(i)})),l.call(i),l.exit().remove();var c=r.select(".actor-links").selectAll(".actor-link").data(R),u=h.FdL,s=h.jvg().curve(u).x((function(t){return t.x})).y((function(t){return t.y})),d=function(t){return t.attr("d",(function(t){var r=t.points;return s(r)})).attr("fill","none").attr("stroke-width",(function(t){return o(t.source)||o(t.target)?2:1})).attr("stroke",(function(t){return o(t.source)||o(t.target)?w.rS.colors.teal[500]:w.rS.colors.gray[300]}))};c.enter().call((function(t){return t.append("path").attr("class","actor-link").call(d)})),c.call(d),c.exit().remove()}}),[Y,R,e,x]),(0,i.jsxs)(y.Fragment,{children:[(0,i.jsxs)(C.u_,{isOpen:l,onClose:u,size:"5xl",children:[(0,i.jsx)(C.ZA,{}),(0,i.jsxs)(C.hz,{children:[(0,i.jsxs)(C.xB,{children:[null===d||void 0===d?void 0:d.operatorId," - ",null===d||void 0===d?void 0:d.name]}),(0,i.jsx)(C.ol,{}),(0,i.jsx)(C.fe,{children:l&&(null===d||void 0===d?void 0:d.node)&&(0,i.jsx)(N,{shouldCollapse:function(t){var r=t.name;return"input"===r||"fields"===r||"streamKey"===r},src:d.node,collapsed:3,name:null,displayDataTypes:!1})}),(0,i.jsx)(C.mz,{children:(0,i.jsx)(f.zx,{colorScheme:"blue",mr:3,onClick:u,children:"Close"})})]})]}),(0,i.jsxs)("svg",{ref:a,width:"".concat(j,"px"),height:"".concat(D,"px"),children:[(0,i.jsx)("g",{className:"actor-links"}),(0,i.jsx)("g",{className:"actors"})]})]})}var Y=n(5330),Z=n(16640);function G(t){var r=t.actors[0],n=function(t){var r;return{name:(null===(r=t.nodeBody)||void 0===r?void 0:r.$case.toString())||"unknown",children:(t.input||[]).map(n),operatorId:t.operatorId,node:t}},e="noDispatcher";r.dispatcher.length>1?e="multipleDispatchers":1===r.dispatcher.length&&(e="".concat((0,p.toLower)(r.dispatcher[0].type),"Dispatcher"));var a=t.actors.reduce((function(t,r){return t[r.actorId]=r.dispatcher,t}),{});return h.bT9({name:e,extraInfo:"Actor ".concat(t.actors.map((function(t){return t.actorId})).join(", ")),children:r.nodes?[n(r.nodes)]:[],operatorId:"dispatcher",node:a})}function L(t){var r=(0,y.useState)(),n=r[0],a=r[1],i=(0,l.pm)();return(0,y.useEffect)((function(){var r=function(){var r=(0,e.Z)(o().mark((function r(){var n;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t();case 3:n=r.sent,a(n),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),i({title:"Error Occurred",description:r.t0.toString(),status:"error",duration:5e3,isClosable:!0}),console.error(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(){return r.apply(this,arguments)}}();r()}),[i,t]),{response:n}}function M(){var t,r,n,e=L(Z.gG).response,a=L(Z.jV).response,o=(0,y.useState)(),h=o[0],p=o[1],x=(0,m.useRouter)(),w=(0,y.useCallback)((function(){if(a&&x.query.id){var t=parseInt(x.query.id),r=a.find((function(r){return r.tableId===t}));if(r){var n=function(t){var r=function(r){var a=t.fragments[r],o=new Set,i=!0,l=!1,c=void 0;try{for(var u,s=a.actors[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var d=u.value,f=!0,h=!1,v=void 0;try{for(var p,x=d.upstreamActorId[Symbol.iterator]();!(f=(p=x.next()).done);f=!0){var g=p.value,m=e.get(g);m&&o.add(m)}}catch(y){h=!0,v=y}finally{try{f||null==x.return||x.return()}finally{if(h)throw v}}}}catch(y){l=!0,c=y}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}n.push({id:a.fragmentId.toString(),name:"Fragment ".concat(a.fragmentId),parentIds:Array.from(o).map((function(t){return t.toString()})),width:0,height:0,order:a.fragmentId,fragment:a})},n=[],e=new Map;for(var a in t.fragments){var o=t.fragments[a],i=!0,l=!1,c=void 0;try{for(var u,s=o.actors[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var d=u.value;e.set(d.actorId,d.fragmentId)}}catch(h){l=!0,c=h}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}}for(var f in t.fragments)r(f);return n}(r);return{fragments:r,fragmentDep:n,fragmentDepDag:(0,v.lu)()(n)}}}}),[a,x.query.id]);(0,y.useEffect)((function(){return e&&(x.query.id||e.length>0&&x.replace("?id=".concat(e[0].id))),function(){}}),[x,x.query.id,e]);var I=null===(t=w())||void 0===t?void 0:t.fragmentDep,b=null===(r=w())||void 0===r?void 0:r.fragmentDepDag,k=null===(n=w())||void 0===n?void 0:n.fragments,S=(0,y.useCallback)((function(){var t=null===k||void 0===k?void 0:k.fragments;if(t){var r=new Map;for(var n in t){var e=G(t[n]);r.set(n,e)}return r}}),[null===k||void 0===k?void 0:k.fragments]),C=S(),D=(0,y.useCallback)((function(){var t=x.query.id;if(t&&e)return e.find((function(r){return r.id==parseInt(t)}))}),[e,x.query.id])(),_=(0,y.useState)(""),N=_[0],A=_[1],z=(0,y.useState)(""),E=z[0],F=z[1],q=function(t){return x.replace("?id=".concat(t))},M=(0,l.pm)(),O=(0,i.jsxs)(c.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,i.jsx)(Y.Z,{children:"Streaming Plan"}),(0,i.jsxs)(c.kC,{flexDirection:"row",height:"full",width:"full",children:[(0,i.jsxs)(c.gC,{mr:3,spacing:3,alignItems:"flex-start",width:200,height:"full",children:[(0,i.jsxs)(u.NI,{children:[(0,i.jsx)(u.lX,{children:"Relations"}),(0,i.jsx)(s.II,{list:"relationList",spellCheck:!1,onChange:function(t){var r,n=null===(r=null===e||void 0===e?void 0:e.find((function(r){return r.name==t.target.value})))||void 0===r?void 0:r.id;n&&q(n)},placeholder:"Search...",mb:2}),(0,i.jsx)("datalist",{id:"relationList",children:e&&e.map((function(t){return(0,i.jsxs)("option",{value:t.name,children:["(",t.id,") ",t.name]},t.id)}))}),(0,i.jsx)(d.Ph,{value:x.query.id,onChange:function(t){return q(parseInt(t.target.value))},children:e&&e.map((function(t){return(0,i.jsxs)("option",{value:t.id,children:["(",t.id,") ",t.name]},t.name)}))})]}),(0,i.jsxs)(u.NI,{children:[(0,i.jsx)(u.lX,{children:"Goto"}),(0,i.jsxs)(c.gC,{spacing:2,children:[(0,i.jsxs)(c.Ug,{children:[(0,i.jsx)(s.II,{placeholder:"Fragment Id",value:E,onChange:function(t){return F(t.target.value)}}),(0,i.jsx)(f.zx,{onClick:function(t){return function(){var t=parseInt(E);if(a){var r=!0,n=!1,e=void 0;try{for(var o,i=a[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;for(var c in l.fragments)if(l.fragments[c].fragmentId==t)return q(l.tableId),void p(t)}}catch(u){n=!0,e=u}finally{try{r||null==i.return||i.return()}finally{if(n)throw e}}}M({title:"Fragment not found",description:"",status:"error",duration:5e3,isClosable:!0})}()},children:"Go"})]}),(0,i.jsxs)(c.Ug,{children:[(0,i.jsx)(s.II,{placeholder:"Actor Id",value:N,onChange:function(t){return A(t.target.value)}}),(0,i.jsx)(f.zx,{onClick:function(t){return function(){var t=parseInt(N);if(a){var r=!0,n=!1,e=void 0;try{for(var o,i=a[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;for(var c in l.fragments){var u=l.fragments[c],s=!0,d=!1,f=void 0;try{for(var h,v=u.actors[Symbol.iterator]();!(s=(h=v.next()).done);s=!0)if(h.value.actorId==t)return q(l.tableId),void p(u.fragmentId)}catch(x){d=!0,f=x}finally{try{s||null==v.return||v.return()}finally{if(d)throw f}}}}}catch(x){n=!0,e=x}finally{try{r||null==i.return||i.return()}finally{if(n)throw e}}}M({title:"Actor not found",description:"",status:"error",duration:5e3,isClosable:!0})}()},children:"Go"})]})]})]}),(0,i.jsxs)(c.kC,{height:"full",width:"full",flexDirection:"column",children:[(0,i.jsx)(c.xv,{fontWeight:"semibold",children:"Plan"}),D&&(0,i.jsxs)(c.xv,{children:[D.id," - ",D.name]}),b&&(0,i.jsx)(c.xu,{flex:"1",overflowY:"scroll",children:(0,i.jsx)(j,{svgWidth:200,mvDependency:b,onSelectedIdChange:function(t){return p(parseInt(t))},selectedId:null===h||void 0===h?void 0:h.toString()})})]})]}),(0,i.jsxs)(c.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,i.jsx)(c.xv,{fontWeight:"semibold",children:"Fragment Graph"}),C&&I&&(0,i.jsx)(R,{selectedFragmentId:null===h||void 0===h?void 0:h.toString(),fragmentDependency:I,planNodeDependencies:C})]})]})]});return(0,i.jsxs)(y.Fragment,{children:[(0,i.jsx)(g(),{children:(0,i.jsx)("title",{children:"Streaming Fragments"})}),O]})}}},function(t){t.O(0,[662,482,476,894,591,855,136,836,640,293,774,888,179],(function(){return r=64248,t(t.s=r);var r}));var r=t.O();_N_E=r}]);